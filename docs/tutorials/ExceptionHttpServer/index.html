<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 at 2021-02-15 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Daniel Sagenschneider" />
    <meta name="Date-Revision-yyyymmdd" content="20210215" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Exception handling HTTP Server Tutorial &#x2013; Exception Handling Tutorial</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.5.min.js"></script>

          <!-- shortcut icon -->
			<link rel="shortcut icon" href="/favicon.ico" />
			
			<!-- www.addthis.com (for sharing) -->
			<script type="text/javascript">
				$(document).ready(function() {
					var addThisScript = document.createElement("script");
					addThisScript.type = 'text/javascript';
					addThisScript.src = '//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5c6e0c0bac25d2cf';
					document.body.appendChild(addThisScript);
				})
			</script>
                  <!-- Google Analytics -->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-23477455-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
          </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="https://github.com/officefloor/OfficeFloor">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                    <a href="https://officefloor.net/" id="bannerLeft">
                                                                                        <img src="https://officefloor.net/images/OfficeFloorBannerImage.png"  alt="OfficeFloor"/>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                              <li class="">
                    <a href="../../index.html" title="OfficeFloor">
        OfficeFloor</a>
                    <span class="divider">/</span>
      </li>
            <li class="">
                    <a href="../index.html" title="Tutorials">
        Tutorials</a>
                    <span class="divider">/</span>
      </li>
            <li class="">
                    <a href="index.html" title="Exception handling HTTP Server Tutorial">
        Exception handling HTTP Server Tutorial</a>
                    <span class="divider">/</span>
      </li>
        <li class="active ">Exception Handling Tutorial</li>
        
              
                  <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2021-02-15</li>
              <li id="projectVersion" class="pull-right">
                    Version: 3.32.0
        </li>
            
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                    <li class="nav-header">Parent Project</li>
                              
      <li>
  
                          <a href="../index.html" title="Tutorials">
          <span class="none"></span>
        Tutorials</a>
            </li>
            </ul>
              
                            <form id="search-form" action="https://www.google.com/search" method="get" >
    
  <input value="officefloor.net/officefloor/tutorials/ExceptionHttpServer/" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="https://cse.google.com/brand?form=search-form"></script>
          
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                                                                                                                   <a href="https://github.com/sponsors/sagenschneider" title="Support" class="builtBy">
        <img class="builtBy"  alt="Support" src="https://officefloor.net/images/sponsor.jpg"    />
      </a>
                      </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <div class="section">
<h2><a name="Exception_Handling_Tutorial"></a>Exception Handling Tutorial</h2>
<p>This tutorial demonstrates the ease in handling exceptions within an WoOF web application.</p>
<p>The tutorial will demonstrate this by a template method throwing an exception that is handled by writing the exception to <tt>stderr</tt>. Though this is a simple example it does demonstrate the ease of handling exceptions.</p>
<p>This tutorial also introduces the <tt>@Parameter</tt> annotation to allow passing an object between methods.</p>
<p><a class="externalLink" href="https://github.com/officefloor/OfficeFloor/tree/master/officefloor/tutorials/ExceptionHttpServer">Tutorial Source</a></p>
<div class="section">
<h3><a name="Template_throwing_exception"></a>Template throwing exception</h3>
<p>The following is the template:</p>
<div class="source"><pre class="prettyprint">&lt;html&gt;
    &lt;form action=&quot;#{submit}&quot;&gt;
        &lt;input type=&quot;submit&quot; /&gt;
    &lt;/form&gt;
&lt;/html&gt;
</pre></div>
<p>with the logic throwing the exception:</p>
<div class="source"><pre class="prettyprint">public class TemplateLogic {

	public void submit() throws Exception {
		throw new SQLException(&quot;Test&quot;);
	}

}
</pre></div>
<p>Pressing the submit button will trigger the exception to be thrown. </p>
<p>The tutorial will demonstrate the ease in which this exception can be handled.</p></div>
<div class="section">
<h3><a name="Exception_handling_configuration"></a>Exception handling configuration</h3>
<p>The following shows the configuration for handling the above template exception.</p><img src="./images/ExceptionHttpServer-configuration.png" alt="ExceptionHttpServer screen shot." />
<p>The exception is linked to be handled by the following:</p>
<div class="source"><pre class="prettyprint">public class ExceptionHandler {

	public void handleSqlException(@Parameter SQLException ex) {
		// Production code may take some action and would use a Logger
		System.err.println(ex.getMessage());
	}

}
</pre></div>
<p>Once the handling method completes it follows normal WoOF behaviour. In other words, the static error page is then sent to the client.</p></div>
<div class="section">
<h3><a name="a.40Parameter"></a>@Parameter</h3>
<p>The <tt>@Parameter</tt> annotation identifies a value to be passed from the previous method.</p>
<p>The handling of an exception is actually via OfficeFloor functionality. The exception is caught by WoOF and passed as a parameter to the configured method. In this case, the <tt>handleSqlException(...)</tt> method.</p>
<p>The <tt>@Parameter</tt> annotation can also be used to obtain the value from the following:</p>
<ul>
<li>receive the exception being handled (as in above example)</li>
<li>return value from the previous method</li>
<li>parameter to a <tt>@FlowInterface</tt> method</li></ul>
<p>This functionality is useful and provided by the underlying OfficeFloor framework. However, within WoOF the necessity to pass parameters is used typically only for exception handling. The use of dependency injected objects is often a better way to pass state between methods (i.e. <a href="/apidocs/net/officefloor/web/HttpRequestStateful.html">HttpRequestStateful</a>).</p></div>
<div class="section">
<h3><a name="Resource"></a>Resource</h3>
<p>The remaining configuration indicates that the following static response should be sent.</p>
<div class="source"><pre class="prettyprint">&lt;html&gt;
	&lt;body&gt;
		&lt;p&gt;Technical error has occurred.&lt;/p&gt;
	&lt;/body&gt;
&lt;/html&gt;
</pre></div>
<p>It is possible to use the details of the exception within a template to generate a response. However, for simplicity a static resource is used.</p></div>
<div class="section">
<h3><a name="Unit_Test"></a>Unit Test</h3>
<p>The following unit test shows the exception handling by listening in on <tt>stderr</tt> to ensure the exception message is written to it:</p>
<div class="source"><pre class="prettyprint">@ExtendWith(OfficeFloorExtension.class)
public class ExceptionHttpServerTest {

	@RegisterExtension
	public HttpClientExtension client = new HttpClientExtension();

	private PrintStream stderr;

	@BeforeEach
	public void setup() {
		// Maintain stderr to reinstate
		this.stderr = System.err;
	}

	@Test
	public void ensureHandleException() throws Exception {

		// Override stderr
		ByteArrayOutputStream error = new ByteArrayOutputStream();
		System.setErr(new PrintStream(error, true));

		// Submit to trigger the exception
		HttpResponse response = this.client.execute(new HttpGet(this.client.url(&quot;/template+submit&quot;)));
		assertEquals(200, response.getStatusLine().getStatusCode(), &quot;Should be successful&quot;);

		// Ensure handling by logging the failure
		String log = new String(error.toByteArray()).trim();
		assertEquals(&quot;Test&quot;, log, &quot;Should log error&quot;);
	}

	@AfterEach
	public void reinstate() {
		// Reinstate stderr
		System.setErr(this.stderr);
	}
}
</pre></div>
<p>JUnit 4 example:</p>
<div class="source"><pre class="prettyprint">public class ExceptionHttpServerJUnit4Test {

	@Rule
	public OfficeFloorRule officeFloor = new OfficeFloorRule(this);

	@Rule
	public HttpClientRule client = new HttpClientRule();

	private PrintStream stderr;

	@Before
	public void setup() {
		// Maintain stderr to reinstate
		this.stderr = System.err;
	}

	@Test
	public void ensureHandleException() throws Exception {

		// Override stderr
		ByteArrayOutputStream error = new ByteArrayOutputStream();
		System.setErr(new PrintStream(error, true));

		// Submit to trigger the exception
		HttpResponse response = this.client.execute(new HttpGet(this.client.url(&quot;/template+submit&quot;)));
		assertEquals(&quot;Should be successful&quot;, 200, response.getStatusLine().getStatusCode());

		// Ensure handling by logging the failure
		String log = new String(error.toByteArray()).trim();
		assertEquals(&quot;Should log error&quot;, &quot;Test&quot;, log);
	}

	@After
	public void reinstate() {
		// Reinstate stderr
		System.setErr(this.stderr);
	}
}
</pre></div></div></div>
<div class="section">
<h2><a name="Next"></a>Next</h2>
<p>The <a href="../DiPojoHttpServer/index.html">next tutorial</a> covers dependency injection.</p></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                                <p class="pull-right">Copyright &copy;                    2005&#x2013;2021
                        <a href="http://officefloor.net">OfficeFloor</a>.
            All rights reserved.    
      </p>
                </div>

        
                </div>
    </footer>
        </body>
</html>
