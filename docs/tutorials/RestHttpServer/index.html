<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 at 2021-05-05 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Daniel Sagenschneider" />
    <meta name="Date-Revision-yyyymmdd" content="20210505" />
    <meta http-equiv="Content-Language" content="en" />
    <title>REST Tutorial &#x2013; REST Tutorial</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.5.min.js"></script>

          <!-- shortcut icon -->
			<link rel="shortcut icon" href="/favicon.ico" />
			
			<!-- www.addthis.com (for sharing) -->
			<script type="text/javascript">
				$(document).ready(function() {
					var addThisScript = document.createElement("script");
					addThisScript.type = 'text/javascript';
					addThisScript.src = '//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5c6e0c0bac25d2cf';
					document.body.appendChild(addThisScript);
				})
			</script>
                  <!-- Google Analytics -->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-23477455-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
          </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="https://github.com/officefloor/OfficeFloor">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                    <a href="https://officefloor.net/" id="bannerLeft">
                                                                                        <img src="https://officefloor.net/images/OfficeFloorBannerImage.png"  alt="OfficeFloor"/>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                              <li class="">
                    <a href="../../index.html" title="OfficeFloor">
        OfficeFloor</a>
                    <span class="divider">/</span>
      </li>
            <li class="">
                    <a href="../index.html" title="Tutorials">
        Tutorials</a>
                    <span class="divider">/</span>
      </li>
            <li class="">
                    <a href="index.html" title="REST Tutorial">
        REST Tutorial</a>
                    <span class="divider">/</span>
      </li>
        <li class="active ">REST Tutorial</li>
        
              
                  <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2021-05-05</li>
              <li id="projectVersion" class="pull-right">
                    Version: 3.35.0
        </li>
            
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                    <li class="nav-header">Parent Project</li>
                              
      <li>
  
                          <a href="../index.html" title="Tutorials">
          <span class="none"></span>
        Tutorials</a>
            </li>
            </ul>
              
                            <form id="search-form" action="https://www.google.com/search" method="get" >
    
  <input value="officefloor.net/officefloor/tutorials/RestHttpServer/" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="https://cse.google.com/brand?form=search-form"></script>
          
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                                                                                                                   <a href="https://github.com/sponsors/sagenschneider" title="Support" class="builtBy">
        <img class="builtBy"  alt="Support" src="https://officefloor.net/images/sponsor.jpg"    />
      </a>
                      </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <div class="section">
<h2><a name="REST_Tutorial"></a>REST Tutorial</h2>
<p>This tutorial demonstrates REST with WoOF.</p>
<p>The example used in this tutorial is two end points:</p>
<ul>
<li><tt>POST /vehicle</tt> <tt>{&quot;vehicleType&quot;:&quot;car&quot;,&quot;wheels&quot;:4}</tt> to create a vehicle entry </li>
<li><tt>GET /vehicle/{id}</tt> to obtain the vehicle entry by the vehicle's identifier</li></ul>
<p><a class="externalLink" href="https://github.com/officefloor/OfficeFloor/tree/master/officefloor/tutorials/RestHttpServer">Tutorial Source</a></p>
<div class="section">
<h3><a name="WoOF_configuration"></a>WoOF configuration</h3>
<p>To configure REST end-points with WoOF, use the following from the palette:</p>
<ul>
<li><tt>HTTP Continuation</tt> to provide GET end points</li>
<li><tt>HTTP Input</tt> to provide other HTTP method end points</li></ul>
<p>The <tt>HTTP Continuation</tt> is separate, as HTTP redirects are <i>continuations</i> via GET methods. Therefore, it is possible to connect to this to trigger a redirect to the respective URL.</p>
<p>The configuration of the two end points are as follows:</p><img src="./images/RestHttpServer-configuration.png" alt="RestHttpServer screen shot." />
<p>The handling of the end-points is provided by connecting them to other items. In this case, <tt>procedures</tt> provide the implementation of the end points.</p></div>
<div class="section">
<h3><a name="Object_parsing_.2F_responding"></a>Object parsing / responding</h3>
<p>Similar to <a href="../JavaScriptApp/index.html">AJAX with templates tutorial</a> object parsing and responding is via the <a href="/apidocs/net/officefloor/web/HttpObject.html">@HttpObject</a> and <a href="/apidocs/net/officefloor/web/ObjectResponse.html">ObjectResponse</a>. The below is the object used in this tutorial:</p>
<div class="source"><pre class="prettyprint">@Entity
@HttpObject
@Data
@NoArgsConstructor
@RequiredArgsConstructor
public class Vehicle {

	@Id
	@GeneratedValue(strategy = GenerationType.IDENTITY)
	private Integer id;

	@NonNull
	@Column(name = &quot;VEHICLE_TYPE&quot;)
	private String vehicleType;

	@NonNull
	private Integer wheels;
}
</pre></div>
<p>For convenience, the <tt>Entity</tt> object is re-used for parsing out the <tt>POST</tt> pay load.</p>
<p>The implementation of the <tt>POST</tt> handling is the following: </p>
<div class="source"><pre class="prettyprint">	public void createVehicle(Vehicle vehicle, EntityManager entityManager) {
		if ((vehicle == null) || (vehicle.getVehicleType() == null)) {
			throw new HttpException(new HttpStatus(444, &quot;Must have vehicleType&quot;));
		}
		entityManager.persist(vehicle);
	}
</pre></div>
<p>As the JSON data is loaded onto the object, it is passed to the <tt>EntityManager</tt> to store within the database.</p>
<p>Should there be invalid data, a <a href="/apidocs/net/officefloor/server/http/HttpException.html">HttpException</a> can be thrown to specify the response status code and entity pay load. In this case, a custom status code is used.</p></div>
<div class="section">
<h3><a name="Path_parameters"></a>Path parameters</h3>
<p>Using <tt>{...}</tt> within the path specifies a path parameter.</p>
<p>In the case of this tutorial, this is used to specify the vehicle identifier within the URL. </p>
<p>Note that multiple path parameters may be specified in the URL along with ability to specify them where ever appropriate in the URL. The only requirement is that path parameters in the URL are separated by at least one character. </p>
<p>The following demonstrates passing the path parameter value to the handling logic:</p>
<div class="source"><pre class="prettyprint">	public void getVehicle(@HttpPathParameter(&quot;id&quot;) String vehicleId, EntityManager entityManager,
			ObjectResponse&lt;Vehicle&gt; responder) {
		responder.send(entityManager.find(Vehicle.class, Integer.parseInt(vehicleId)));
	}
</pre></div>
<p>The <a href="/apidocs/net/officefloor/web/HttpPathParameter.html">@HttpPathParameter</a> annotation specifies to load the path value. See the other annotations in the package for extracting various aspects of the HTTP request.</p></div>
<div class="section">
<h3><a name="Testing"></a>Testing</h3>
<p>The following shows the ease of testing the REST end points:</p>
<div class="source"><pre class="prettyprint">	@RegisterExtension
	public final MockWoofServerExtension server = new MockWoofServerExtension();

	@Test
	public void postMissingData() throws Exception {

		// POST with missing data
		MockHttpResponse response = this.server
				.send(MockHttpServer.mockRequest(&quot;/vehicle&quot;).method(HttpMethod.POST).entity(&quot;{}&quot;));
		response.assertResponse(444, &quot;{\&quot;error\&quot;:\&quot;Must have vehicleType\&quot;}&quot;);
	}

	@Test
	public void postEntry(EntityManager entityManager) throws Exception {

		// POST to create row and validate successful
		MockHttpResponse response = this.server.send(MockHttpServer.mockRequest(&quot;/vehicle&quot;).method(HttpMethod.POST)
				.header(&quot;content-type&quot;, &quot;application/json&quot;).entity(&quot;{ \&quot;vehicleType\&quot;: \&quot;bike\&quot;, \&quot;wheels\&quot;: 2 }&quot;));
		response.assertResponse(204, &quot;&quot;);

		// Ensure row created
		Vehicle vehicle = entityManager.createQuery(&quot;SELECT V FROM Vehicle V WHERE vehicleType = 'bike'&quot;, Vehicle.class)
				.getSingleResult();
		assertNotNull(vehicle, &quot;Should have row created&quot;);
		assertEquals(2, vehicle.getWheels().intValue(), &quot;Incorrect row&quot;);
	}

	@Test
	public void getEntry(EntityManager entityManager) throws Exception {

		// Create entry
		Vehicle vehicle = new Vehicle(&quot;car&quot;, 4);
		entityManager.persist(vehicle);
		JpaManagedObjectSource.commitTransaction(entityManager);

		// GET entry
		MockHttpResponse response = this.server.send(MockHttpServer.mockRequest(&quot;/vehicle/&quot; + vehicle.getId()));
		assertEquals(200, response.getStatus().getStatusCode(), &quot;Should be successful&quot;);
		response.assertHeader(&quot;content-type&quot;, &quot;application/json&quot;);
		JsonNode entity = new ObjectMapper().readTree(response.getEntity(null));
		assertEquals(vehicle.getId().intValue(), entity.get(&quot;id&quot;).asInt(), &quot;Incorrect id&quot;);
		assertEquals(&quot;car&quot;, entity.get(&quot;vehicleType&quot;).asText(), &quot;Incorrect vehicle type&quot;);
		assertEquals(4, entity.get(&quot;wheels&quot;).asInt(), &quot;Incorrect wheels&quot;);
	}
</pre></div>
<p>However, as the logic is a POJO (plain old java object), the logic can also be unit tested as follows:</p>
<div class="source"><pre class="prettyprint">	@Test
	public void createWithMissingData(EntityManager entityManager) {
		try {
			new RestLogic().createVehicle(new Vehicle(), entityManager);
			fail(&quot;Should not be successful&quot;);
		} catch (HttpException ex) {
			assertEquals(444, ex.getHttpStatus().getStatusCode(), &quot;Incorrect status&quot;);
			assertEquals(&quot;Must have vehicleType&quot;, ex.getMessage(), &quot;Incorrect reason&quot;);
		}
	}

	@Test
	public void createVehicle(EntityManager entityManager) {

		// Create the vehicle
		new RestLogic().createVehicle(new Vehicle(&quot;tricycle&quot;, 3), entityManager);

		// Ensure row created
		Vehicle vehicle = entityManager
				.createQuery(&quot;SELECT V FROM Vehicle V WHERE vehicleType = 'tricycle'&quot;, Vehicle.class).getSingleResult();
		assertNotNull(vehicle, &quot;Should have row created&quot;);
		assertEquals(3, vehicle.getWheels().intValue(), &quot;Incorrect row&quot;);
	}

	@Test
	public void getVehicle(EntityManager entityManager) {

		// Create entry
		Vehicle created = new Vehicle(&quot;unicycle&quot;, 1);
		entityManager.persist(created);

		// Obtain the vehicle
		MockObjectResponse&lt;Vehicle&gt; response = new MockObjectResponse&lt;&gt;();
		new RestLogic().getVehicle(String.valueOf(created.getId()), entityManager, response);
		Vehicle vehicle = response.getObject();
		assertEquals(&quot;unicycle&quot;, vehicle.getVehicleType(), &quot;Incorrect row sent&quot;);
	}
</pre></div></div></div>
<div class="section">
<h2><a name="Next"></a>Next</h2>
<p>The <a href="../StaticContentHttpServer/index.html">next tutorial</a> covers serving static (files) content for single page applications.</p></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                                <p class="pull-right">Copyright &copy;                    2005&#x2013;2021
                        <a href="http://officefloor.net">OfficeFloor</a>.
            All rights reserved.    
      </p>
                </div>

        
                </div>
    </footer>
        </body>
</html>
