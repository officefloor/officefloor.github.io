<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 at 2021-05-05 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Daniel Sagenschneider" />
    <meta name="Date-Revision-yyyymmdd" content="20210505" />
    <meta http-equiv="Content-Language" content="en" />
    <title>JavaScript Application Tutorial &#x2013; JavaScript, AJAX, JSON Tutorial</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.5.min.js"></script>

          <!-- shortcut icon -->
			<link rel="shortcut icon" href="/favicon.ico" />
			
			<!-- www.addthis.com (for sharing) -->
			<script type="text/javascript">
				$(document).ready(function() {
					var addThisScript = document.createElement("script");
					addThisScript.type = 'text/javascript';
					addThisScript.src = '//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5c6e0c0bac25d2cf';
					document.body.appendChild(addThisScript);
				})
			</script>
                  <!-- Google Analytics -->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-23477455-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
          </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="https://github.com/officefloor/OfficeFloor">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                    <a href="https://officefloor.net/" id="bannerLeft">
                                                                                        <img src="https://officefloor.net/images/OfficeFloorBannerImage.png"  alt="OfficeFloor"/>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                              <li class="">
                    <a href="../../index.html" title="OfficeFloor">
        OfficeFloor</a>
                    <span class="divider">/</span>
      </li>
            <li class="">
                    <a href="../index.html" title="Tutorials">
        Tutorials</a>
                    <span class="divider">/</span>
      </li>
            <li class="">
                    <a href="index.html" title="JavaScript Application Tutorial">
        JavaScript Application Tutorial</a>
                    <span class="divider">/</span>
      </li>
        <li class="active ">JavaScript, AJAX, JSON Tutorial</li>
        
              
                  <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2021-05-05</li>
              <li id="projectVersion" class="pull-right">
                    Version: 3.35.0
        </li>
            
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                    <li class="nav-header">Parent Project</li>
                              
      <li>
  
                          <a href="../index.html" title="Tutorials">
          <span class="none"></span>
        Tutorials</a>
            </li>
            </ul>
              
                            <form id="search-form" action="https://www.google.com/search" method="get" >
    
  <input value="officefloor.net/officefloor/tutorials/JavaScriptApp/" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="https://cse.google.com/brand?form=search-form"></script>
          
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                                                                                                                   <a href="https://github.com/sponsors/sagenschneider" title="Support" class="builtBy">
        <img class="builtBy"  alt="Support" src="https://officefloor.net/images/sponsor.jpg"    />
      </a>
                      </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <div class="section">
<h2><a name="JavaScript.2C_AJAX.2C_JSON_Tutorial"></a>JavaScript, AJAX, JSON Tutorial</h2>
<p>This tutorial looks at using JavaScript within WoOF templates and interacting with the WoOF server by AJAX (by both HTTP parameters and JSON).</p>
<p>To focus on JavaScript and AJAX, the below simple application will undertake adding or subtracting from a number. While this can be accomplished client-side with JavaScript, the tutorial demonstrates AJAX by sending the values to the WoOF server to undertake the calculations.</p><img src="./images/JavaScriptApp-screenshot.png" alt="JavaScriptApp screen shot." />
<p><a class="externalLink" href="https://github.com/officefloor/OfficeFloor/tree/master/officefloor/tutorials/JavaScriptApp">Tutorial Source</a></p>
<div class="section">
<h3><a name="JavaScript"></a>JavaScript</h3>
<p>The below is the HTML and JavaScript for the page. While production applications should use a JavaScript framework (e.g. <a class="externalLink" href="http://jQuery.org">jQuery</a>) to handle issues such as cross browser differences, the tutorial will use raw JavaScript to show it is JavaScript framework agnostic.</p>
<p>The reason that WoOF may use any JavaScript framework is that it does not interpret the web page contents. WoOF treats the content of a web page as text, providing only the necessary tag replacements. In the case below, WoOF provides the URLs for the AJAX calls. This means any JavaScript code (whether raw or part of a framework) may be included in the WoOF templates. It even means that WoOF templates can be used for other content types such as XML. The focus of this tutorial will be on including JavaScript within HTML web pages.</p>
<div class="source"><pre class="prettyprint">&lt;html&gt;

&lt;head&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
	
	function addition() {
		var numberOne = document.getElementById(&quot;result&quot;).innerHTML
		var numberTwo = document.getElementById(&quot;value&quot;).value
		doAjax( { url: &quot;#{addition}&quot;
				, contentType: &quot;application/x-www-form-urlencoded&quot;
				, payload: &quot;numberOne=&quot; + numberOne + &quot;&amp;numberTwo=&quot; + numberTwo
				, handler: function(response) { document.getElementById(&quot;result&quot;).innerHTML = response; }
				})
	}

	function subtraction() {
		var numberOne = document.getElementById(&quot;result&quot;).innerHTML
		var numberTwo = document.getElementById(&quot;value&quot;).value;
		doAjax( { url: &quot;#{subtraction}&quot;
				, contentType: &quot;application/json&quot;
				, payload: JSON.stringify({numberOne: numberOne, numberTwo: numberTwo})
				, handler: function(response) { 
						document.getElementById(&quot;result&quot;).innerHTML = JSON.parse(response).result
					}
				})
	}
	
	function doAjax( request ) {
		var ajax = new XMLHttpRequest();
		ajax.open(&quot;POST&quot;, request.url, false)
		ajax.setRequestHeader(&quot;Content-type&quot;, request.contentType)
		ajax.onreadystatechange = function() {
			if (ajax.readyState == 4) {
				request.handler.call( request, ajax.responseText )
			}
		}
		ajax.send( request.payload )
	}
		
&lt;/script&gt;
&lt;/head&gt;

&lt;body&gt;

	&lt;h1 id=&quot;result&quot;&gt;1&lt;/h1&gt;
	
	&lt;p&gt;&lt;input id=&quot;value&quot; type=&quot;text&quot; value=&quot;1&quot; size=&quot;4&quot; /&gt;
		&lt;input type=&quot;button&quot; value=&quot;add&quot; onclick=&quot;addition()&quot; /&gt;
		&lt;input type=&quot;button&quot; value=&quot;subtract&quot; onclick=&quot;subtraction()&quot; /&gt;&lt;/p&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre></div>
<p>Different payload types (HTTP parameters and JSON) are used for the respective AJAX requests. This is to demonstrate in the next sections how WoOF handles each payload type.</p></div>
<div class="section">
<h3><a name="AJAX_with_HTTP_parameters"></a>AJAX with HTTP parameters</h3>
<p>The handling HTTP parameters in the AJAX request is very similar to handling HTML form submissions. The difference is that the default behaviour of re-rendering the template's content is to be avoided. To avoid re-rendering the template's content the below annotation is added to the servicing method to flag to not re-render the template.</p>
<div class="source"><pre class="prettyprint">public class TemplateLogic {

	@Data
	@HttpParameters
	public static class AdditionRequest implements Serializable {
		private static final long serialVersionUID = 1L;

		private String numberOne;
		private String numberTwo;
	}

	@NotRenderTemplateAfter
	public void addition(AdditionRequest request, ServerHttpConnection connection) throws IOException {

		// Add the numbers
		int result = Integer.parseInt(request.getNumberOne()) + Integer.parseInt(request.getNumberTwo());

		// Return the result
		connection.getResponse().getEntityWriter().write(String.valueOf(result));
	}
</pre></div></div>
<div class="section">
<h3><a name="AJAX_with_JSON"></a>AJAX with JSON</h3>
<p>To handle JSON content in both the request and response, the JSON content is mapped to Java Objects. The below demonstrates the:</p>
<ul>
<li><a href="/apidocs/net/officefloor/web/HttpObject.html">@HttpObject</a> annotation on the parameter class to have the injected object loaded from the request's entity content. Due to the <tt>Content-Type</tt> this will trigger JSON mapping.</li>
<li><a href="/apidocs/net/officefloor/web/ObjectResponse.html">ObjectResponse</a> to write the object response. Due to either <tt>Accept</tt>, <tt>Content-Type</tt> headers of the request, an appropriate object mapper is used. In this case, JSON.
<div class="source"><pre class="prettyprint">	@Data
	@HttpObject
	public static class SubtractionRequest implements Serializable {
		private static final long serialVersionUID = 1L;

		private String numberOne;
		private String numberTwo;
	}

	@Data
	public static class JsonResponse {
		private final String result;
	}

	@NotRenderTemplateAfter
	public void subtraction(SubtractionRequest request, ObjectResponse&lt;JsonResponse&gt; response) throws IOException {

		// Subtract the numbers
		int result = Integer.parseInt(request.getNumberOne()) - Integer.parseInt(request.getNumberTwo());

		// Return the result
		response.send(new JsonResponse(String.valueOf(result)));
	}

}
</pre></div></li></ul>
<p>The underlying implementation of JSON to Java Object mapping is via <a class="externalLink" href="http://github.com/FasterXML/jackson">Jackson</a>. Please see their documentation regarding additional annotations available to Java Objects to fine tune mapping of JSON to/from Java Objects.</p></div>
<div class="section">
<h3><a name="Generic_Object_handling"></a>Generic Object handling</h3>
<p>You will notice in the JSON example that there is no mention of JSON. The reason is that the code is agnostic to the underlying wire format and therefore re-usable for say receiving / sending XML.</p>
<p>To integrate your own wire formats provide implementations of the following services:</p>
<ul>
<li><a href="/apidocs/net/officefloor/web/build/HttpObjectParserServiceFactory.html">HttpObjectParserServiceFactory</a> to parse the input request entity into an object.</li>
<li><a href="/apidocs/net/officefloor/web/build/HttpObjectResponderServiceFactory.html">HttpObjectResponderServiceFactory</a> to write the output object as a response entity.</li></ul></div>
<div class="section">
<h3><a name="Unit_Test"></a>Unit Test</h3>
<p>The following unit tests manually undertake the AJAX calls to the WoOF server and verifying the correct responses.</p>
<div class="source"><pre class="prettyprint">@ExtendWith(OfficeFloorExtension.class)
public class JavaScriptAppTest {

	@RegisterExtension
	public HttpClientExtension client = new HttpClientExtension();

	@Test
	public void testHttpParameters() throws IOException {
		String response = this.doAjax(&quot;addition&quot;, &quot;application/x-www-form-urlencoded&quot;, &quot;numberOne=2&amp;numberTwo=1&quot;);
		assertEquals(&quot;3&quot;, response, &quot;Incorrect response&quot;);
	}

	@Test
	public void testHttpJson() throws IOException {
		String response = this.doAjax(&quot;subtraction&quot;, &quot;application/json&quot;,
				&quot;{ \&quot;numberOne\&quot; : \&quot;3\&quot;, \&quot;numberTwo\&quot; : \&quot;1\&quot; }&quot;);
		assertEquals(&quot;{\&quot;result\&quot;:\&quot;2\&quot;}&quot;, response, &quot;Incorrect response&quot;);
	}

	private String doAjax(String link, String contentType, String payload) throws IOException {
		HttpPost post = new HttpPost(&quot;http://localhost:7878/template+&quot; + link);
		post.addHeader(&quot;content-type&quot;, contentType);
		post.setEntity(new StringEntity(payload));
		HttpResponse response = this.client.execute(post);
		String entity = EntityUtils.toString(response.getEntity());
		assertEquals(200, response.getStatusLine().getStatusCode(), &quot;Should be successful: &quot; + entity);
		return entity;
	}
</pre></div></div></div>
<div class="section">
<h2><a name="Next"></a>Next</h2>
<p>The <a href="../SectionHttpServer/index.html">next tutorial</a> looks at sectioning the template.</p></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                                <p class="pull-right">Copyright &copy;                    2005&#x2013;2021
                        <a href="http://officefloor.net">OfficeFloor</a>.
            All rights reserved.    
      </p>
                </div>

        
                </div>
    </footer>
        </body>
</html>
