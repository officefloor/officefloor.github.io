<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 at 2021-05-05 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Daniel Sagenschneider" />
    <meta name="Date-Revision-yyyymmdd" content="20210505" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Interactive HTTP Server Tutorial &#x2013; Interactive HTTP Server Tutorial</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.5.min.js"></script>

          <!-- shortcut icon -->
			<link rel="shortcut icon" href="/favicon.ico" />
			
			<!-- www.addthis.com (for sharing) -->
			<script type="text/javascript">
				$(document).ready(function() {
					var addThisScript = document.createElement("script");
					addThisScript.type = 'text/javascript';
					addThisScript.src = '//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5c6e0c0bac25d2cf';
					document.body.appendChild(addThisScript);
				})
			</script>
                  <!-- Google Analytics -->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-23477455-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
          </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="https://github.com/officefloor/OfficeFloor">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                    <a href="https://officefloor.net/" id="bannerLeft">
                                                                                        <img src="https://officefloor.net/images/OfficeFloorBannerImage.png"  alt="OfficeFloor"/>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                              <li class="">
                    <a href="../../index.html" title="OfficeFloor">
        OfficeFloor</a>
                    <span class="divider">/</span>
      </li>
            <li class="">
                    <a href="../index.html" title="Tutorials">
        Tutorials</a>
                    <span class="divider">/</span>
      </li>
            <li class="">
                    <a href="index.html" title="Interactive HTTP Server Tutorial">
        Interactive HTTP Server Tutorial</a>
                    <span class="divider">/</span>
      </li>
        <li class="active ">Interactive HTTP Server Tutorial</li>
        
              
                  <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2021-05-05</li>
              <li id="projectVersion" class="pull-right">
                    Version: 3.35.0
        </li>
            
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                    <li class="nav-header">Parent Project</li>
                              
      <li>
  
                          <a href="../index.html" title="Tutorials">
          <span class="none"></span>
        Tutorials</a>
            </li>
            </ul>
              
                            <form id="search-form" action="https://www.google.com/search" method="get" >
    
  <input value="officefloor.net/officefloor/tutorials/InteractiveHttpServer/" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="https://cse.google.com/brand?form=search-form"></script>
          
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                                                                                                                   <a href="https://github.com/sponsors/sagenschneider" title="Support" class="builtBy">
        <img class="builtBy"  alt="Support" src="https://officefloor.net/images/sponsor.jpg"    />
      </a>
                      </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <div class="section">
<h2><a name="Interactive_HTTP_Server_Tutorial"></a>Interactive HTTP Server Tutorial</h2>
<p>This tutorial looks at handling a form submission.</p>
<p>The below example for this tutorial will implement a simple form submission. The form submission will validate a name was entered and provide a message if successfully entered.</p>
<p>The simple form for this tutorial is as follows:</p><img src="./images/InteractiveHttpServer-screenshot.png" alt="InteractiveHttpServer screen shot." />
<p><a class="externalLink" href="https://github.com/officefloor/OfficeFloor/tree/master/officefloor/tutorials/InteractiveHttpServer">Tutorial Source</a></p>
<div class="section">
<h3><a name="Template.woof.html"></a>Template.woof.html</h3>
<p>The below is the content of the <tt>Template.woof.html</tt>.</p>
<div class="source"><pre class="prettyprint">&lt;html&gt;
	&lt;body&gt;
		&lt;form action=&quot;#{POST:handleSubmission}&quot; method=&quot;POST&quot;&gt;
			&lt;p&gt;Name: &lt;input type=&quot;text&quot; name=&quot;name&quot; value=&quot;${name}&quot; /&gt; ${nameIssue ${message} $}&lt;/p&gt;
			&lt;p&gt;Description: &lt;input type=&quot;text&quot; name=&quot;description&quot; value=&quot;${description}&quot; /&gt;&lt;/p&gt;
			&lt;p&gt;&lt;input type=&quot;submit&quot; value=&quot;Add&quot; /&gt;&lt;/p&gt;
		&lt;/form&gt;
		&lt;p&gt;${successMessage}&lt;/p&gt;
	&lt;/body&gt;
&lt;/html&gt;
</pre></div>
<p>The difference to previous tutorials is that the HTTP method is qualified in the link. This configures WoOF to handle the POST method in this case. This is used to specify handling of various other HTTP methods (useful for REST interaction with the server).</p>
<p>The default handling for unqualified links is both GET and POST. This is to support common use cases of link navigation and form submissions. </p></div>
<div class="section">
<h3><a name="TemplateLogic_Class"></a>TemplateLogic Class</h3>
<p>The logic to handle the form submission is the following:</p>
<div class="source"><pre class="prettyprint">public class TemplateLogic {

	@Data
	@HttpParameters
	public static class Parameters implements Serializable {
		private static final long serialVersionUID = 1L;

		private String name;

		private Issue nameIssue;

		private String description;

		private String successMessage;
	}

	@Data
	public static class Issue implements Serializable {
		private static final long serialVersionUID = 1L;

		private final String message;
	}

	/**
	 * Obtains the bean for rendering the template.
	 * 
	 * @param submittedParameters Same {@link Parameters} that was constructed for
	 *                            {@link #handleSubmission(Parameters)}. This allows
	 *                            the page to be rendered with the values provided
	 *                            by the client.
	 * @return {@link Parameters} for rendering to page.
	 */
	public Parameters getTemplateData(Parameters submittedParameters) {
		return submittedParameters;
	}

	/**
	 * Reflectively invoked to handle form submission.
	 * 
	 * @param submittedParameters {@link Parameters} which is dependency injected.
	 *                            It is constructed via its default constructor and
	 *                            has the HTTP parameters values loaded by
	 *                            corresponding names.
	 */
	public void handleSubmission(Parameters submittedParameters) {

		// Ensure have a name provided
		String name = submittedParameters.getName();
		if ((name == null) || (name.trim().length() == 0)) {
			submittedParameters.setNameIssue(new Issue(&quot;Must provide name&quot;));
			return;
		}

		// TODO use values to undertake some business logic. Typically would
		// provider further dependencies as parameters to this method to allow
		// this.

		// Provide success message (and clear values)
		submittedParameters.setSuccessMessage(&quot;Thank you &quot; + name);
		submittedParameters.setName(null);
		submittedParameters.setDescription(null);
	}
}
</pre></div>
<p>The aspects to notice are:</p>
<ul>
<li>the method <tt>handleSubmission()</tt> matches in name to the <tt>#{handleSubmission}</tt> of the HTML form action. As the names are the same, WoOF will reflectively invoke the method to handle the form submission. By default WoOF will re-render the page after the method completes. Later tutorials will look at controlling navigation to other pages. </li>
<li>the <tt>Parameters</tt> inner class is annotated with <tt>@HttpParameters</tt>. As this is dependency injected into the form handling method, WoOF sees the annotation and will construct an instance of the object by its default constructor and load the HTTP parameters to its setter methods by corresponding names (e.g. <tt>name</tt> to <tt>setName(String name)</tt>). Note that this object is constructed once for each HTTP request so is the same object dependency injected into the <tt>getTemplateData(...)</tt> method - allowing entered values to be re-rendered to the page.</li>
<li>the <tt>Parameters</tt> inner class is serializable. By default WoOF will undertake the <a class="externalLink" href="http://en.wikipedia.org/wiki/Post/Redirect/Get">Post/Redirect/Get</a> pattern after the <tt>handleSubmission()</tt> method completes and before the template is re-rendered. To enable the state of the <tt>Parameters</tt> object to be available across the redirect, it is added to the <a href="/apidocs/net/officefloor/web/session/HttpSession.html">HttpSession</a> and subsequently must be serializable.</li></ul>
<p>OfficeFloor achieves this simple interactive programming model by substituting into the rendered page a unique URL which it can map back to the corresponding method. The method is matched by its name and is free to have any parameters it requires (enabled by OfficeFloor's continuation injection and dependency injection). For example in more complex applications the handling methods may include a parameter for a <tt>DataSource</tt> or <tt>EntityManager</tt> to enable database interaction rather than just providing a message back to the client. Later tutorials will explain how to inject further dependencies.</p></div>
<div class="section">
<h3><a name="Unit_Test"></a>Unit Test</h3>
<p>The unit test requests the various URL's exposed from the template.</p>
<div class="source"><pre class="prettyprint">	@RegisterExtension
	public final OfficeFloorExtension officeFloor = new OfficeFloorExtension();

	@RegisterExtension
	public final HttpClientExtension client = new HttpClientExtension();

	@Test
	public void pageInteraction() throws Exception {

		// Request the initial page
		HttpResponse response = this.client.execute(new HttpGet(this.client.url(&quot;/example&quot;)));
		assertEquals(200, response.getStatusLine().getStatusCode(), &quot;Request should be successful&quot;);
		String responseEntity = EntityUtils.toString(response.getEntity());
		assertFalse(responseEntity.contains(&quot;Daniel&quot;), &quot;Should not have entry&quot;);

		// Send form submission
		HttpPost post = new HttpPost(this.client.url(&quot;/example+handleSubmission&quot;));
		post.setHeader(&quot;Content-Type&quot;, &quot;application/x-www-form-urlencoded&quot;);
		post.setEntity(new StringEntity(&quot;name=Daniel&amp;description=founder&quot;));
		response = this.client.execute(post);
		assertEquals(200, response.getStatusLine().getStatusCode(), &quot;Should submit successfully&quot;);
		responseEntity = EntityUtils.toString(response.getEntity());
		assertTrue(responseEntity.contains(&quot;&lt;p&gt;Thank you Daniel&lt;/p&gt;&quot;), &quot;Should indicate added&quot;);
	}
</pre></div></div></div>
<div class="section">
<h2><a name="Next"></a>Next</h2>
<p>The <a href="../SessionHttpServer/index.html">next tutorial</a> looks at storing state between requests within a HTTP session.</p></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                                <p class="pull-right">Copyright &copy;                    2005&#x2013;2021
                        <a href="http://officefloor.net">OfficeFloor</a>.
            All rights reserved.    
      </p>
                </div>

        
                </div>
    </footer>
        </body>
</html>
