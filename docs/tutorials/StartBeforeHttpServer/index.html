<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 at 2021-01-21 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Daniel Sagenschneider" />
    <meta name="Date-Revision-yyyymmdd" content="20210121" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Start Before Tutorial &#x2013; Start Up Ordering Tutorial</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.5.min.js"></script>

          <!-- shortcut icon -->
			<link rel="shortcut icon" href="/favicon.ico" />
			
			<!-- www.addthis.com (for sharing) -->
			<script type="text/javascript">
				$(document).ready(function() {
					var addThisScript = document.createElement("script");
					addThisScript.type = 'text/javascript';
					addThisScript.src = '//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5c6e0c0bac25d2cf';
					document.body.appendChild(addThisScript);
				})
			</script>
                  <!-- Google Analytics -->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-23477455-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
          </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="https://github.com/officefloor/OfficeFloor">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                    <a href="https://officefloor.net/" id="bannerLeft">
                                                                                        <img src="https://officefloor.net/images/OfficeFloorBannerImage.png"  alt="OfficeFloor"/>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                              <li class="">
                    <a href="../../index.html" title="OfficeFloor">
        OfficeFloor</a>
                    <span class="divider">/</span>
      </li>
            <li class="">
                    <a href="../index.html" title="Tutorials">
        Tutorials</a>
                    <span class="divider">/</span>
      </li>
            <li class="">
                    <a href="index.html" title="Start Before Tutorial">
        Start Before Tutorial</a>
                    <span class="divider">/</span>
      </li>
        <li class="active ">Start Up Ordering Tutorial</li>
        
              
                  <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2021-01-21</li>
              <li id="projectVersion" class="pull-right">
                    Version: 3.31.0
        </li>
            
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                    <li class="nav-header">Parent Project</li>
                              
      <li>
  
                          <a href="../index.html" title="Tutorials">
          <span class="none"></span>
        Tutorials</a>
            </li>
            </ul>
              
                            <form id="search-form" action="https://www.google.com/search" method="get" >
    
  <input value="officefloor.net/officefloor/tutorials/StartBeforeHttpServer/" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="https://cse.google.com/brand?form=search-form"></script>
          
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                                                                                                                   <a href="https://github.com/sponsors/sagenschneider" title="Support" class="builtBy">
        <img class="builtBy"  alt="Support" src="https://officefloor.net/images/sponsor.jpg"    />
      </a>
                      </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <div class="section">
<h2><a name="Start_Up_Ordering_Tutorial"></a>Start Up Ordering Tutorial</h2>
<p>This tutorial demonstrates ability to order the start up of various <a href="/apidocs/net/officefloor/frame/api/managedobject/source/ManagedObjectSource.html">ManagedObjectSource</a> instances. It will do so by ordering the <a class="externalLink" href="https://flywaydb.org/">Flyway</a> migration to always occur before JPA validation of the schema.</p>
<p><a class="externalLink" href="https://github.com/officefloor/OfficeFloor/tree/master/officefloor/tutorials/StartBeforeHttpServer">Tutorial Source</a></p>
<div class="section">
<h3><a name="Start_Order_Configuration"></a>Start Order Configuration</h3>
<p>Flyway is configured as per the <a href="../FlywayHttpServer/index.html">Flyway Tutorial</a>.</p>
<p>The following demonstrates the object configuration:</p>
<div class="source"><pre class="prettyprint">	&lt;managed-object source=&quot;net.officefloor.jpa.hibernate.HibernateJpaManagedObjectSource&quot; type=&quot;javax.persistence.EntityManager&quot;&gt;
		&lt;property name=&quot;persistence.unit.name&quot; value=&quot;test&quot; /&gt;
		&lt;property name=&quot;persistence.dependency&quot; value=&quot;datasource&quot; /&gt;
		&lt;property name=&quot;hibernate.hbm2ddl.auto&quot; value=&quot;validate&quot; /&gt;
		&lt;start-after type=&quot;net.officefloor.flyway.FlywayMigration&quot; /&gt;
	&lt;/managed-object&gt;

	&lt;managed-object source=&quot;net.officefloor.jdbc.DataSourceManagedObjectSource&quot;&gt;
		&lt;property-file path=&quot;datasource.properties&quot; /&gt;
	&lt;/managed-object&gt;
</pre></div>
<p>The <tt>start-after</tt> configuration indicates for JPA to start after the Flyway migration has complete.</p>
<p>This ordering is even enforced if the start up is executed by another team, as per the tutorial's configuration:</p>
<div class="source"><pre class="prettyprint">	&lt;team source=&quot;net.officefloor.frame.impl.spi.team.ExecutorCachedTeamSource&quot; type=&quot;javax.sql.DataSource&quot; /&gt;
</pre></div>
<p>There is also <tt>start-before</tt> for flagging to starting before.</p>
<p>Note that without this configuration, the <a href="/apidocs/net/officefloor/frame/api/managedobject/source/ManagedObjectSource.html">ManagedObjectSource</a> instances are likely to start in parallel for improved start up performance. However, in the case of this tutorial, the JPA validation could then occur before the Flyway migration completed causing the JPA validation to fail. Hence, the start ordering is provided to avoid these issues.</p></div>
<div class="section">
<h3><a name="Testing"></a>Testing</h3>
<p>The following test starts the application and retrieves the migrated data:</p>
<div class="source"><pre class="prettyprint">	@RegisterExtension
	public final MockWoofServerExtension server = new MockWoofServerExtension();

	@Test
	public void ensureSetup() {
		MockWoofResponse response = this.server.send(MockWoofServer.mockRequest(&quot;/message&quot;));
		response.assertJson(200, new Message(1, &quot;SETUP&quot;));
	}
</pre></div></div></div>
<div class="section">
<h2><a name="Next"></a>Next</h2>
<p>The <a href="../ThreadAffinityHttpServer/index.html">next tutorial</a> covers using <a href="/apidocs/net/officefloor/frame/api/executive/source/ExecutiveSource.html">ExecutiveSource</a> for thread affinity.</p></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                                <p class="pull-right">Copyright &copy;                    2005&#x2013;2021
                        <a href="http://officefloor.net">OfficeFloor</a>.
            All rights reserved.    
      </p>
                </div>

        
                </div>
    </footer>
        </body>
</html>
